<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>Playful Travel Recommender</title>
<style>
body{
  font-family:'Helvetica Neue',Arial,sans-serif;
  background: linear-gradient(135deg, #90A4AE, #CFD8DC);
  margin:0;padding:0;
  display:flex;flex-direction:column;
  align-items:center;
  justify-content:flex-start;
  min-height:100vh;
  color:#333;
}

header{
  width:100%;
  text-align:center;
  padding:30px 0;
}
header h1{
  margin:0;
  font-size:28px;
  color:#fff;
  text-shadow:0 2px 5px rgba(0,0,0,0.3);
}

.wizard{
  background:rgba(255,255,255,0.9);
  max-width:400px;
  width:90%;
  margin-top:40px;
  padding:30px;
  border-radius:15px;
  box-shadow:0 5px 20px rgba(0,0,0,0.2);
  display:flex;
  flex-direction:column;
  gap:25px;
  position:relative;
}

.wizard-step{
  display:none;
  flex-direction:column;
  gap:15px;
}
.wizard-step.active{
  display:flex;
}

label{
  font-weight:bold;
  font-size:16px;
  margin-bottom:5px;
  color:#444;
}

select, .activities-container{
  width:100%;
  padding:12px;
  border:1px solid #ccc;
  border-radius:8px;
  background:#fff;
  font-size:16px;
  color:#333;
}

.activities-container{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
}
.activity-item{
  background:#eee;
  border-radius:20px;
  padding:8px 15px;
  cursor:pointer;
  user-select:none;
  transition:background 0.3s,color 0.3s;
  font-size:14px;
  color:#555;
}
.activity-item.selected{
  background:#8D6E63;
  color:#fff;
}

button{
  padding:12px 25px;
  border:none;
  border-radius:10px;
  font-size:16px;
  cursor:pointer;
  background:#8D6E63;
  color:#fff;
  transition:background 0.3s;
  margin-top:10px;
  align-self:center;
  font-weight:bold;
}
button:hover{
  background:#7C5B52;
}
.prev-btn{
  background:#B0BEC5;
}
.prev-btn:hover{
  background:#9CA9AE;
}

.results-section{
  width:100%;
  max-width:400px;
  margin-top:40px;
  position:relative;
  height:600px;
  overflow:hidden;
  display:none;
  display:flex;
  flex-direction:column;
  align-items:center;
}

.card-stack{
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  width:100%;
  height:100%;
}

.card{
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  width:90%;
  background:#fff;
  border-radius:20px;
  box-shadow:0 5px 20px rgba(0,0,0,0.2);
  padding:30px 20px;
  text-align:center;
  transition:transform 0.3s;
  user-select:none;
  max-height:80%;
  display:flex;
  flex-direction:column;
  justify-content:space-between;
}
.card h2{
  margin:0 0 15px;
  font-size:24px;
  color:#333;
}
.card p{
  margin:0;
  font-size:16px;
  line-height:1.4;
  color:#555;
}
.card a{
  display:inline-block;
  margin-top:20px;
  background:#4CAF50;
  color:#fff;
  padding:12px 25px;
  text-decoration:none;
  border-radius:8px;
  font-size:16px;
  font-weight:bold;
}
.card a:hover{
  background:#43a047;
}

.swipe-hint{
  text-align:center;
  margin-bottom:20px;
  color:#fff;
  font-size:18px;
  font-weight:bold;
  text-shadow:0 1px 2px rgba(0,0,0,0.5);
}

.arrows{
  position:absolute;
  top:50%;
  transform:translateY(-50%);
  width:100%;
  display:flex;
  justify-content:space-between;
  pointer-events:none;
  z-index:999; /* Ensure arrows are on top */
}
.arrow-btn{
  pointer-events:auto;
  background:rgba(255,255,255,0.8);
  width:50px;height:50px;
  display:flex;align-items:center;justify-content:center;
  border-radius:50%;
  box-shadow:0 2px 5px rgba(0,0,0,0.3);
  cursor:pointer;
  margin:0 20px;
  transition:background 0.3s;
}
.arrow-btn:hover{
  background:rgba(255,255,255,1);
}
.arrow-btn:active{
  transform:scale(0.95);
}
.arrow-btn svg{
  width:24px;height:24px;
  fill:#8D6E63;
}

@media (max-width:500px){
  .card{
    padding:20px;
  }
  .card h2{
    font-size:20px;
  }
  .card p{
    font-size:14px;
  }
  .card a{
    font-size:14px;
    padding:10px 15px;
  }
  .arrow-btn{
    width:40px;
    height:40px;
  }
  .arrow-btn svg{
    width:20px;
    height:20px;
  }
}
</style>
</head>
<body>
<header>
<h1>Find Your Next Adventure</h1>
</header>

<div class="wizard">
  <div class="wizard-step step-1 active">
    <label for="regionFilter">Select Region:</label>
    <select id="regionFilter">
      <option value="">Any</option>
      <option value="Europe">Europe</option>
      <option value="Asia">Asia</option>
      <option value="Americas">Americas</option>
      <option value="Oceania">Oceania</option>
      <option value="Africa">Africa</option>
    </select>
    <button class="next-btn">Next</button>
  </div>
  <div class="wizard-step step-2">
    <label for="budgetFilter">Budget Level:</label>
    <select id="budgetFilter">
      <option value="">Any</option>
      <option value="Cheap">Cheap</option>
      <option value="Mid-range">Mid-range</option>
      <option value="Luxury">Luxury</option>
    </select>
    <div style="display:flex;justify-content:space-between">
      <button class="prev-btn">Back</button>
      <button class="next-btn">Next</button>
    </div>
  </div>
  <div class="wizard-step step-3">
    <label>Select Activities (multi-select):</label>
    <div class="activities-container" id="activitiesContainer">
      <div class="activity-item" data-activity="Beach">Beach</div>
      <div class="activity-item" data-activity="Hiking">Hiking</div>
      <div class="activity-item" data-activity="Nightlife">Nightlife</div>
      <div class="activity-item" data-activity="Culture">Culture</div>
      <div class="activity-item" data-activity="Shopping">Shopping</div>
    </div>
    <div style="display:flex;justify-content:space-between">
      <button class="prev-btn">Back</button>
      <button class="next-btn">Next</button>
    </div>
  </div>
  <div class="wizard-step step-4">
    <label for="climateFilter">Climate:</label>
    <select id="climateFilter">
      <option value="">Any</option>
      <option value="Warm">Warm</option>
      <option value="Cold">Cold</option>
      <option value="Temperate">Temperate</option>
    </select>
    <div style="display:flex;justify-content:space-between">
      <button class="prev-btn">Back</button>
      <button class="finish-btn">Find Destinations</button>
    </div>
  </div>
</div>

<div class="results-section">
  <div class="swipe-hint">Drag cards or use arrows to swipe</div>
  <div class="arrows">
    <div class="arrow-btn left" id="leftBtn">
      <svg viewBox="0 0 24 24"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
    </div>
    <div class="arrow-btn right" id="rightBtn">
      <svg viewBox="0 0 24 24"><path d="M8.59 16.59L10 18l6-6-6-6-1.41 1.41L13.17 12z"/></svg>
    </div>
  </div>
  <div class="card-stack" id="cardStack"></div>
</div>

<script>
const GSheetURL="https://docs.google.com/spreadsheets/d/e/2PACX-1vQbq36KXieC6aKe3KfwM7162IGCZE-WAKHJ7xyScSLrvs92G64vp4BkFaAn0ikrObiBY0jZUYX1Ugpz/pub?gid=0&single=true&output=csv";

let allData=[];
const steps=document.querySelectorAll('.wizard-step');
let currentStep=0;
document.querySelectorAll('.next-btn').forEach(btn=>{
  btn.addEventListener('click',()=>{
    if(currentStep<steps.length-1){
      steps[currentStep].classList.remove('active');
      currentStep++;
      steps[currentStep].classList.add('active');
    }
  });
});
document.querySelectorAll('.prev-btn').forEach(btn=>{
  btn.addEventListener('click',()=>{
    if(currentStep>0){
      steps[currentStep].classList.remove('active');
      currentStep--;
      steps[currentStep].classList.add('active');
    }
  });
});
document.querySelector('.finish-btn').addEventListener('click',()=>{
  steps[currentStep].classList.remove('active');
  showResults();
});

document.getElementById('activitiesContainer').addEventListener('click',e=>{
  if(e.target.classList.contains('activity-item')){
    e.target.classList.toggle('selected');
  }
});

async function fetchData(){
  const response=await fetch(GSheetURL);
  const text=await response.text();
  return csvToArray(text);
}

function csvToArray(str,delimiter=","){
  const headers=str.slice(0,str.indexOf("\n")).split(delimiter).map(h=>h.trim());
  const rows=str.slice(str.indexOf("\n")+1).split("\n");
  const arr=rows.map(row=>{
    const values=row.split(delimiter).map(v=>v.trim());
    let obj={};
    headers.forEach((h,i)=>obj[h]=values[i]?values[i]:"");
    return obj;
  }).filter(o=>o.Destination);
  return arr;
}

function filterData(data,region,budget,activities,climate){
  return data.filter(item=>{
    let regionMatch=!region||item.Region.split(",").map(i=>i.trim()).includes(region);
    let budgetMatch=!budget||item.BudgetLevel.split(",").map(i=>i.trim()).includes(budget);
    let climateMatch=!climate||item.Climate.split(",").map(i=>i.trim()).includes(climate);

    let itemActivities=item.Activities.split(",").map(i=>i.trim());
    let activitiesMatch=true;
    if(activities.length>0){
      activitiesMatch=activities.some(a=>itemActivities.includes(a));
    }

    return regionMatch&&budgetMatch&&activitiesMatch&&climateMatch;
  });
}

function showResults(){
  const region=document.getElementById('regionFilter').value;
  const budget=document.getElementById('budgetFilter').value;
  const climate=document.getElementById('climateFilter').value;
  const selectedActivities=[...document.querySelectorAll('.activity-item.selected')].map(a=>a.getAttribute('data-activity'));

  const filtered=filterData(allData,region,budget,selectedActivities,climate);
  const resultsSection=document.querySelector('.results-section');
  const cardStack=document.getElementById('cardStack');
  cardStack.innerHTML='';
  if(filtered.length===0){
    alert("No matching destinations found!");
    return;
  }
  resultsSection.style.display='flex';

  for(let i=filtered.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [filtered[i],filtered[j]]=[filtered[j],filtered[i]];
  }

  filtered.forEach((dest,i)=>{
    const card=document.createElement('div');
    card.classList.add('card');
    card.style.zIndex=filtered.length-i;
    card.innerHTML=`
      <h2>${dest.Destination}</h2>
      <p><strong>Region:</strong> ${dest.Region}<br>
      <strong>Budget:</strong> ${dest.BudgetLevel}<br>
      <strong>Activities:</strong> ${dest.Activities}<br>
      <strong>Climate:</strong> ${dest.Climate}</p>
      <a href="${dest.Reflink}" target="_blank">Book Now</a>
    `;
    cardStack.appendChild(card);

    let startX=0,currentX=0;
    let dragging=false;

    // Touch events
    card.addEventListener('touchstart',e=>{
      dragging=true;
      startX=e.touches[0].clientX;
    });
    card.addEventListener('touchmove',e=>{
      if(!dragging)return;
      currentX=e.touches[0].clientX-startX;
      card.style.transform=`translate(${currentX}px,-50%) rotate(${currentX/20}deg)`;
    });
    card.addEventListener('touchend',()=>{
      endSwipe(card,currentX);
      dragging=false;
    });

    // Mouse events for PC
    card.addEventListener('mousedown',e=>{
      dragging=true;
      startX=e.clientX;
    });
    card.addEventListener('mousemove',e=>{
      if(!dragging)return;
      currentX=e.clientX-startX;
      card.style.transform=`translate(${currentX}px,-50%) rotate(${currentX/20}deg)`;
    });
    card.addEventListener('mouseup',()=>{
      endSwipe(card,currentX);
      dragging=false;
    });
    card.addEventListener('mouseleave',()=>{
      if(dragging){
        endSwipe(card,currentX);
        dragging=false;
      }
    });
  });

  const leftBtn=document.getElementById('leftBtn');
  const rightBtn=document.getElementById('rightBtn');
  leftBtn.addEventListener('click',()=>{
    const topCard=getTopCard();
    if(topCard) swipeCard(topCard,-200);
  });
  rightBtn.addEventListener('click',()=>{
    const topCard=getTopCard();
    if(topCard) swipeCard(topCard,200);
  });
}

function endSwipe(card,currentX){
  if(currentX>100){
    card.style.transform=`translate(1000px,-50%)`;
    setTimeout(()=>card.remove(),300);
  }else if(currentX<-100){
    card.style.transform=`translate(-1000px,-50%)`;
    setTimeout(()=>card.remove(),300);
  }else{
    card.style.transform=`translate(-50%,-50%)`;
  }
}

function getTopCard(){
  const cards=[...document.querySelectorAll('.card')];
  if(cards.length===0)return null;
  return cards.reduce((top,c)=>{
    return parseInt(c.style.zIndex)>parseInt(top.style.zIndex)?c:top;
  });
}

function swipeCard(card,direction){
  card.style.transform=`translate(${direction>0?1000:-1000}px,-50%)`;
  setTimeout(()=>card.remove(),300);
}

// Init
fetchData().then(data=>{
  allData=data;
});
</script>
</body>
</html>
